# APIå¥‘ç´„ï¼ˆAPI Contractï¼‰ã¨JSON

## æ¦‚è¦
APIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆæä¾›è€…ï¼‰ã¨ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ï¼ˆåˆ©ç”¨è€…ï¼‰ã®é–“ã®ã€Œç´„æŸäº‹ã€ã‚’å®šç¾©ã—ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã§ä¿è¨¼ã™ã‚‹ä»•çµ„ã¿ã€‚

## ä½¿ç”¨å ´é¢
- REST APIã‚’è¨­è¨ˆãƒ»é–‹ç™ºã™ã‚‹æ™‚
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒãƒ¼ãƒ ãŒåˆ†ã‹ã‚Œã¦ã„ã‚‹æ™‚
- APIã®å¤‰æ›´ãŒæ—¢å­˜ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å£Šã•ãªã„ã‹ç¢ºèªã—ãŸã„æ™‚
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã ã‘ã§ãªãã€å¥‘ç´„ã‚’ã‚³ãƒ¼ãƒ‰ã§ä¿è¨¼ã—ãŸã„æ™‚

## ã‚³ãƒ¼ãƒ‰

### APIå¥‘ç´„ã®æ§‹æˆè¦ç´ 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         å¥‘ç´„          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APIã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  APIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼   â”‚
â”‚  ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç­‰ï¼‰ â”‚   ã€Œã“ã†ä½¿ãˆã°     â”‚  ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰   â”‚
â”‚                 â”‚    ã“ã†è¿”ã™ã€       â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¥‘ç´„ã®ä¾‹ï¼šCashCard API

| é …ç›® | å¥‘ç´„å†…å®¹ |
|------|---------|
| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | `GET /cashcards/{id}` |
| æˆåŠŸæ™‚ | 200 OK + JSONæœ¬ä½“ã‚’è¿”ã™ |
| å­˜åœ¨ã—ãªã„å ´åˆ | 404 Not Found ã‚’è¿”ã™ |
| èªè¨¼ãªã— | 401 Unauthorized ã‚’è¿”ã™ |

### JSONã®å½¢å¼ã‚‚å¥‘ç´„ã®ä¸€éƒ¨
```json
// ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ã¯ã€Œã“ã®å½¢å¼ã§è¿”ã£ã¦ãã‚‹ã€ã¨æœŸå¾…ã™ã‚‹
{
  "id": 99,
  "amount": 123.45,
  "owner": "sarah1"
}
```

### å¥‘ç´„é•åã®ä¾‹
```json
// âŒ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒå‹æ‰‹ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’å¤‰æ›´
{
  "id": 99,
  "balance": 123.45,  // amount â†’ balance ã«å¤‰æ›´
  "owner": "sarah1"
}
// â†’ ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ã®ã‚¢ãƒ—ãƒªãŒå£Šã‚Œã‚‹ï¼ˆamountã‚’æ¢ã—ã¦ã‚¨ãƒ©ãƒ¼ï¼‰
```

### å¥‘ç´„ãƒ†ã‚¹ãƒˆï¼ˆContract Testï¼‰
```java
@Test
void shouldReturnCashCardWithCorrectJsonStructure() {
    ResponseEntity<String> response =
        restTemplate.getForEntity("/cashcards/99", String.class);

    // å¥‘ç´„: 200ã‚’è¿”ã™
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);

    // å¥‘ç´„: JSONã«ã“ã‚Œã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹
    DocumentContext json = JsonPath.parse(response.getBody());
    assertThat(json.read("$.id", Long.class)).isEqualTo(99);
    assertThat(json.read("$.amount", Double.class)).isEqualTo(123.45);
    assertThat(json.read("$.owner", String.class)).isEqualTo("sarah1");
}
```

### `ResponseEntity<String>` ã¨ `getBody()` ã®é–¢ä¿‚

`getBody()` ã¯ `String` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªãã€`ResponseEntity<String>` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã€‚

```
ResponseEntity<T>
  â”œâ”€â”€ getStatusCode()   â†’ HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ (200, 404 ãªã©)
  â”œâ”€â”€ getHeaders()      â†’ HTTPãƒ˜ãƒƒãƒ€ãƒ¼
  â””â”€â”€ getBody()         â†’ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ â† å‹Tã§è¿”ã‚‹
```

`<String>` ã¨ã„ã†ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã¯ã€Œãƒœãƒ‡ã‚£ã‚’ã©ã®å‹ã¨ã—ã¦å—ã‘å–ã‚‹ã‹ã€ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã€‚

| ã‚³ãƒ¼ãƒ‰ | å‹ |
|---|---|
| `response` | `ResponseEntity<String>` |
| `response.getStatusCode()` | `HttpStatus` |
| `response.getBody()` | `String` |

`ResponseEntity<String>` ã«ã™ã‚‹ç†ç”±ã¯ã€ãƒœãƒ‡ã‚£ã‚’JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ‘ãƒ¼ã‚¹ã›ãš**ç”Ÿã®æ–‡å­—åˆ—ã¨ã—ã¦å—ã‘å–ã‚Š**ã€JsonPathã§ç´°ã‹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã€‚`ResponseEntity<CashCard>` ã«ã™ã‚‹ã¨ãƒœãƒ‡ã‚£ãŒCashCardã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã•ã‚Œã¦ã—ã¾ã„ã€JSONã®æ§‹é€ ãã®ã‚‚ã®ã‚’ãƒ†ã‚¹ãƒˆã—ã«ãããªã‚‹ã€‚

## èª¬æ˜

### APIå¥‘ç´„ã§æ±ºã‚ã‚‹ã¹ãã“ã¨
1. **ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ã¯ã©ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ã‹
2. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: APIã¯ã©ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’ã„ã¤è¿”ã™ã‹
3. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: èª¤ã£ãŸä½¿ç”¨ã‚„å•é¡Œç™ºç”Ÿæ™‚ã«ä½•ã‚’è¿”ã™ã‹

### ãªãœãƒ†ã‚¹ãƒˆã§å¥‘ç´„ã‚’æ›¸ãã®ã‹

**å£ç´„æŸãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã ã‘ã®å•é¡Œï¼š**
```
é–‹ç™ºè€…A: ã€Œamountãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§è¿”ã™ã­ã€
é–‹ç™ºè€…B: ã€Œäº†è§£ã€
ï¼ˆ3ãƒ¶æœˆå¾Œã€AãŒå¿˜ã‚Œã¦balanceã«å¤‰æ›´...ï¼‰
â†’ æœ¬ç•ªã§ãƒã‚°ç™ºè¦š ğŸ’¥
```

**ãƒ†ã‚¹ãƒˆã§å¥‘ç´„ã‚’æ›¸ããƒ¡ãƒªãƒƒãƒˆï¼š**
- èª°ã‹ãŒ`amount`ã‚’`balance`ã«å¤‰ãˆãŸã‚‰ â†’ **ãƒ†ã‚¹ãƒˆãŒå¤±æ•—**
- å¥‘ç´„é•åãŒ**è‡ªå‹•ã§æ¤œå‡º**ã•ã‚Œã‚‹
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ˆã‚Š**ä¿¡é ¼ã§ãã‚‹**ï¼ˆã‚³ãƒ¼ãƒ‰ã¯å˜˜ã‚’ã¤ã‹ãªã„ï¼‰

### ç”¨èªã¾ã¨ã‚
| ç”¨èª | æ„å‘³ |
|------|------|
| **APIå¥‘ç´„** | ã€Œã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯ã“ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€ã¨ã„ã†ç´„æŸ |
| **JSON** | ãã®å¥‘ç´„ã§ä½¿ã‚ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ |
| **å¥‘ç´„ãƒ†ã‚¹ãƒˆ** | ç´„æŸãŒå®ˆã‚‰ã‚Œã¦ã„ã‚‹ã‹è‡ªå‹•ã§ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆ |

### æ ¸å¿ƒ
> ã€Œå£ç´„æŸã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã ã‘ã§ãªãã€**ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å¥‘ç´„ã‚’æ›¸ã‘**ã€
> â†’ å¥‘ç´„é•åã¯å³åº§ã«ãƒ†ã‚¹ãƒˆå¤±æ•—ã¨ã—ã¦æ¤œå‡ºã§ãã‚‹

## å‚è€ƒ
- [Spring Contract Testing](https://spring.io/projects/spring-cloud-contract)
- [Consumer-Driven Contracts](https://martinfowler.com/articles/consumerDrivenContracts.html)

## é–¢é€£ã‚¹ãƒ‹ãƒšãƒƒãƒˆ
- [Spring MVC ControlleråŸºç¤](./controller/spring-mvc-controller-basics.md)
- [RestController](./rest-controller.md)
- [RESTã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ/ã‚µãƒ¼ãƒãƒ¼ã®æ¦‚å¿µ](./rest-client/rest-client-server-concept.md)

## ä½œæˆæ—¥
2026-02-04

## ã‚¿ã‚°
#spring #rest-api #api-contract #json #testing #contract-test
