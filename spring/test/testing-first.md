# Test-First Development with Spring Boot

> **学習日:** 2025-02-04  
> **情報源:** https://spring.academy/courses/building-a-rest-api-with-spring-boot/lessons/test-first

---

## 🎯 何のための概念か?

REST APIを開発する際に、本番コードを書く前にテストを先に書くことで、APIの振る舞いを明確に定義し、リファクタリングの安全性を確保するための開発手法。Spring Bootのテストフレームワークを活用して、効率的にREST APIの品質を保証する。

---

## 📚 要点

### この概念を一言で

**テストを先に書き、そのテストをパスする最小限のコードを実装し、リファクタリングで改善する「Red-Green-Refactor」サイクルによるREST API開発手法**

### 重要ポイント

1. **Red-Green-Refactorサイクル**: ①失敗するテストを書く(Red) → ②テストをパスする最小限のコードを書く(Green) → ③コードを改善する(Refactor)
2. **@SpringBootTestアノテーション**: Spring Bootアプリケーション全体をテスト用に起動し、実際のHTTPリクエスト/レスポンスをテストできる統合テスト環境を提供
3. **TestRestTemplateの活用**: HTTPリクエストを簡単に送信し、レスポンスを検証できるSpring Boot提供のテスト用HTTPクライアント

---

## ⚠️ 注意点

### よくある誤解

- ❌ テストファーストは時間がかかるので効率が悪い
  - ✅ 初期投資は必要だが、バグ修正コストの削減や安全なリファクタリングにより、長期的には開発効率が向上する

- ❌ すべてのコードをテストで100%カバーする必要がある
  - ✅ 重要なビジネスロジックやAPIの契約(エンドポイント、ステータスコード等)を中心にテストし、費用対効果を考慮する

### 気をつけるべきこと

- `@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)`を使用してポート競合を避ける
- テストデータの独立性を保つ(各テストが他のテストに影響を与えないようにする)
- テストコードも本番コードと同様に保守性を意識して書く(DRYの原則など)

---

## 💡 理解のポイント

### いつ使うか?

- ✅ 新しいREST APIエンドポイントを追加する時
- ✅ 既存のAPIの振る舞いを変更する前に、現在の振る舞いを保証するテストを書く時
- ✅ チーム開発で他のメンバーが安心してリファクタリングできる環境を作りたい時

### いつ使わないか?

- ❌ プロトタイピングや概念検証(PoC)で素早く動くものを確認したい初期フェーズ
- ❌ 要件が非常に不明確で、APIの仕様が頻繁に大きく変わることが予想される段階
- ❌ 一度きりの使い捨てスクリプトや内部ツール開発

### 類似概念との違い

| 項目                   | Test-First(TDD)              | Test-After                 |
| ---------------------- | ---------------------------- | -------------------------- |
| テストを書くタイミング | 実装前                       | 実装後                     |
| 設計への影響           | テスト可能な設計になりやすい | 既存設計に引きずられる     |
| リファクタリング       | 安心して実施可能             | テストがないため躊躇しがち |
| 初期学習コスト         | 高い(慣れが必要)             | 低い(従来の方法)           |

---

## 🔗 関連

- **公式:** https://spring.io/guides/gs/testing-web/
- **参考:** https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing
- **関連概念:**
  - JUnit 5(テスティングフレームワーク)
  - AssertJ(流暢なアサーションライブラリ)
  - MockMvc(コントローラー層の単体テスト)
  - @WebMvcTest(コントローラー層のスライステスト)
- **code-snippet:** Spring Academyの当該レッスンのGitHubリポジトリ

---

**次のアクション:**

- [ ] 簡単なGETエンドポイントのテストを書いて、Red-Green-Refactorサイクルを体験する
- [ ] 自分のPomodoro Timer APIにテストファーストでPOSTエンドポイントを追加してみる
- [ ] TestRestTemplateとAssertJのAPIドキュメントを確認し、使えるメソッドを把握する
